/*! lazyloader 0.0.2 | 2014-09-03 */
!function(a){"use strict";var b=function(){function a(a){return"DOMElement"===a?function(a){return/^\[object HTML\w*Element\]$/.test(Object.prototype.toString.call(a))}:function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}}function b(a,b,c){return c?void a.setAttribute("data-"+b,c):a.getAttribute("data-"+b)}function c(a){return g(a)?a.split(/\s+/):h(a)?a:void 0}function d(a,b){for(var d=c(b),e=a.className.split(/\s+/),f=0,g=d.length;g>f;f++){for(var h=!1,i=0,j=e.length;j>i;i++)if(d[f]===e[i]){h=!0;break}h||e.push(d[f])}a.className=e.join(" ")}function e(a,b){for(var d=c(b),e=a.className.split(/\s+/),f=0,g=d.length;g>f;f++)for(var h=e.length-1;h>=0;h--)d[f]===e[h]&&e.splice(h,1);a.className=e.join(" ")}var f=a("Object"),g=a("String"),h=Array.isArray||a("Array"),i=a("Function"),j=a("DOMElement");return{isObject:f,isString:g,isArray:h,isFunction:i,isDOMElement:j,data:b,addClass:d,removeClass:e}}(),c=function(){function c(a,b,c){function d(a,b){var c=Math.abs((b.left+b.right)/2-(a.left+a.right)/2),d=Math.abs((b.top+b.bottom)/2-(a.top+a.bottom)/2),e=a.right-a.left+(b.right-b.left),f=a.bottom-a.top+(b.bottom-b.top);return e/2>c&&f/2>d}var g=a.getBoundingClientRect(),h=b.getBoundingClientRect(),i={top:g.top-c,bottom:g.bottom+c,left:g.left-c,right:g.right+c},j={top:0-c,bottom:f+c,left:0-c,right:e+c},k=d(i,h),l=d(j,h);return k&&l}function d(a,c){var d=new Image,e=b.data(a,"src");d.onload=function(){c.emit("itemloaded",a),a.src=e},d.src=e,c.emit("itemstart",a)}var e=a.innerWidth,f=a.innerHeight;a.addEventListener("resize",function(){e=a.innerWidth,f=a.innerHeight});var g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAADklEQVQIW2NkgAJGGAMAAC0AA7HLAIQAAAAASUVORK5CYII=";return function(e,f){function h(){if(b.isString(e))try{n=document.querySelector(e),o=n}catch(c){throw new Error("Lazyloader 构造函数参数不合法, 请使用合法 CSS 选择器或者 DOM 元素.")}else if(b.isDOMElement(e))n=e,o=n;else{if(e!==a)throw new Error("参数类型需要为 String 或 DOMElement");n=document.documentElement,o=a}p=n.querySelectorAll("."+s)}function i(){x.emit("start"),l(),o.addEventListener("scroll",l,!1),r=!0}function j(){x.emit("stop"),o.removeEventListener("scroll",l,!1),r=!1}function k(){x.on("enable",function(){!r&&i()}),x.on("disable",function(){r&&j()}),x.on("itemstart",function(a){b.addClass(a,t),b.data(a,"lazy-status","loading")}),x.on("itemloaded",function(a){b.removeClass(a,t),b.addClass(a,u),b.data(a,"lazy-status","loaded")}),f.onitemstart&&x.on("itemstart",f.onitemstart),f.onitemloaded&&x.on("itemloaded",f.onitemloaded),f.onstart&&x.on("start",f.onstart),f.onloaded&&x.on("stop",f.onstop)}function l(){setTimeout(function(){for(var a=q.length-1;a>=0;a--){var b=q[a];c(n,b,w)&&(d(b,x),Array.prototype.splice.call(q,a,1))}},0)}var m=this;"undefined"==typeof e&&(e=a),b.isObject(e)&&"undefined"==typeof f&&(f=e,e=a);var f=f||{},n=null,o=null,p=null,q=null,r="undefined"!=typeof f.enable?f.enable:!0,s=f.targetClass||"lazy",t=f.loadingClass||"",u=f.loadedClass||"",v=f.placeholder||g,w="undefined"!=typeof f.preLoadDistance?f.preLoadDistance:0,x=function(){var a={};return{on:function(b,c){var d=a[b]||(a[b]=[]);d.push(c)},off:function(b,c){if(!b&&!c)return void(a={});var d=a[b];if(d)if(c)for(var e=d.length-1;e>=0;e--)d[e]===c&&d.splice(e,1);else delete a[b]},emit:function(b,c){var d=a[b];if(d){d=d.slice();for(var e=0,f=d.length;f>e;e++)d[e](c)}}}}();m.enable=function(a){var b=this;return x.emit(a?"enable":"disable"),b},m.isEnable=function(){return r},m.refresh=function(){for(var a=0,c=p.length;c>a;a++)b.data(p[a],"lazy-status")||(b.data(p[a],"lazy-status","unload"),p[a].src=v);var d=n.querySelectorAll("."+s+'[data-lazy-status="unload"]');q=Array.prototype.slice.call(d)},m.sniffer=function(){l()},h(),m.refresh(),k(),r&&i()}}();c.prototype={},"function"==typeof define&&define(function(){return{Lazyloader:c}}),"undefined"!=typeof exports&&(exports.Lazyloader=c),"undefined"!=typeof a&&(a.Lazyloader=c)}(window);